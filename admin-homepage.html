<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Homepage Manager</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Inter&display=swap" rel="stylesheet">

<style>

body{
  font-family:Inter;
  background:#fafafa;
  max-width:1100px;
  margin:auto;
  padding:60px 40px;
}

h1{
  font-family:"Playfair Display";
  font-size:42px;
  margin-bottom:40px;
}

.section{
  background:#fff;
  padding:30px;
  border-radius:18px;
  margin-bottom:40px;
  box-shadow:0 10px 30px rgba(0,0,0,.04);
}

label{
  font-size:11px;
  letter-spacing:.18em;
  text-transform:uppercase;
  color:#777;
  display:block;
  margin:20px 0 6px;
}

input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #e5e5e5;
}

button{
  margin-top:20px;
  padding:14px 28px;
  border-radius:999px;
  border:none;
  background:#111;
  color:#fff;
  cursor:pointer;
}

.item{
  border:1px solid #eee;
  padding:20px;
  border-radius:12px;
  margin-top:20px;
}

</style>
</head>

<body>

<h1>Homepage Manager</h1>

<!-- HERO -->
<div class="section">

<h2>Hero</h2>

<label>Title</label>
<input id="heroTitle">

<label>Subtitle</label>
<input id="heroSubtitle">

<label>Button Text</label>
<input id="heroButton">

<label>Button Link</label>
<input id="heroLink">

<label>Hero Media</label>
<input type="file" id="heroFile">

<button onclick="saveHero()">Save Hero</button>

</div>

<!-- NAV -->
<div class="section">

<h2>Navigation</h2>

<div id="navLinks"></div>

<button onclick="addNav()">Add Link</button>
<button onclick="saveNav()">Save Navigation</button>

</div>

<!-- CURATED -->
<div class="section">

<h2>Curated Grid</h2>

<div id="curatedWrap"></div>

<button onclick="addCurated()">Add Item</button>
<button onclick="saveCurated()">Save Curated</button>

</div>

<!-- SERVICES -->
<div class="section">

<h2>Services</h2>

<div id="servicesWrap"></div>

<button onclick="addService()">Add Service</button>
<button onclick="saveServices()">Save Services</button>

</div>

<!-- SHOP HERO -->
<div class="section">

<h2>Shop Hero</h2>

<label>Title</label>
<input id="shopTitle">

<label>Button</label>
<input id="shopButton">

<label>Link</label>
<input id="shopLink">

<label>Background</label>
<input type="file" id="shopFile">

<button onclick="saveShopHero()">Save Shop Hero</button>

</div>

<script type="module">

import { initializeApp } from
"https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";

import {
  getDatabase,
  ref,
  get,
  update,
  set
} from
"https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";


////////////////////////////////////////////////

const app = initializeApp({
apiKey:"AIzaSyAZ_6nBhOpzPBtYunilmDhcKd0Woe1PWYs",
databaseURL:"https://angelshairmall-default-rtdb.firebaseio.com",
});

const db = getDatabase(app);

////////////////////////////////////////////////
//// CLOUDINARY
////////////////////////////////////////////////

async function upload(file){

const type = file.type.startsWith("video/")
? "video"
: "image";

const fd = new FormData();
fd.append("file",file);
fd.append("upload_preset","angels_gallery");

const res = await fetch(
`https://api.cloudinary.com/v1_1/dln4u67up/${type}/upload`,
{method:"POST",body:fd}
);

const data = await res.json();

return data.secure_url;

}

////////////////////////////////////////////////
//// HERO
////////////////////////////////////////////////
window.saveHero = async()=>{

let media="";

if(heroFile.files[0]){
  media = await upload(heroFile.files[0]);
}else{
  const snap = await get(ref(db,"homepage/hero"));
  media = snap.val()?.image || "";
}

await update(ref(db,"homepage/hero"),{

title: heroTitle.value || "Luxury Hair, Redefined",
subtitle: heroSubtitle.value || "",
buttonText: heroButton.value || "Book Appointment",
buttonLink: heroLink.value || "login.html",
image: media,
enabled: true

});

alert("Hero saved safely ✅");

};


////////////////////////////////////////////////
//// NAV
////////////////////////////////////////////////

window.addNav = ()=>{

navLinks.innerHTML += `
<div class="item">
<input placeholder="Title" class="navTitle">
<input placeholder="URL" class="navUrl">
</div>
`;

};

window.saveNav = async()=>{

const links = [...document.querySelectorAll(".item")].map(i=>({

title:i.querySelector(".navTitle").value,
url:i.querySelector(".navUrl").value

}));

await set(ref(db,"homepage/nav"),{links});

alert("Nav saved");

};
////////////////////////////////////////////////
//// RENDER HELPERS
////////////////////////////////////////////////

function renderCuratedItem(item = {}) {
  curatedWrap.innerHTML += `
    <div class="item">
      <input placeholder="Title" class="cTitle" value="${item.title || ""}">
      <input type="file" class="cFile">
      ${item.image ? `<img src="${item.image}" style="width:80px;margin-top:10px;border-radius:8px">` : ""}
      <button onclick="this.parentElement.remove()">Delete</button>
    </div>
  `;
}
function renderServiceItem(item = {}) {
  servicesWrap.innerHTML += `
    <div class="item">

      <input
        placeholder="Title"
        class="sTitle"
        value="${item.title || ""}"
      >

      <input
        placeholder="Text"
        class="sText"
        value="${item.text || ""}"
      >

      <input
        placeholder="Link"
        class="sLink"
        value="${item.link || ""}"
      >

      <label>Service Video</label>
      <input type="file" class="sVideo" accept="video/*">

      ${
        item.video
          ? `
            <video
              src="${item.video}"
              muted
              autoplay
              loop
              playsinline
              style="width:120px;margin-top:12px;border-radius:10px"
            ></video>
          `
          : `<small style="opacity:.6">No video uploaded yet</small>`
      }

      <button onclick="this.parentElement.remove()">Delete</button>

    </div>
  `;
}

////////////////////////////////////////////////
//// CURATED
////////////////////////////////////////////////

////////////////////////////////////////////////
//// CURATED (PERSISTENT)
////////////////////////////////////////////////

window.addCurated = () => renderCuratedItem();

window.saveCurated = async()=>{

  const items=[];

  for(const el of document.querySelectorAll("#curatedWrap .item")){

    let img = el.querySelector("img")?.src || "";

    if(el.querySelector(".cFile").files[0]){
      img = await upload(el.querySelector(".cFile").files[0]);
    }

    items.push({
      title: el.querySelector(".cTitle").value || "Curated Style",
      image: img
    });
  }

  await update(ref(db,"homepage/curated"),{
    items,
    enabled:true
  });

  alert("Curated saved safely ✅");
};

////////////////////////////////////////////////
//// SERVICES
////////////////////////////////////////////////

window.addService = ()=>{

servicesWrap.innerHTML += `
<div class="item">
<input placeholder="Title" class="sTitle">
<input placeholder="Text" class="sText">
<input placeholder="Link" class="sLink">
<input type="file" class="sVideo">
</div>
`;

};

////////////////////////////////////////////////
//// SERVICES (PERSISTENT)
////////////////////////////////////////////////

window.addService = () => renderServiceItem();

window.saveServices = async()=>{

  const services = [];

  for(const el of document.querySelectorAll("#servicesWrap .item")){

    let video = el.querySelector("video")?.src || "";

    if(el.querySelector(".sVideo").files[0]){
      video = await upload(el.querySelector(".sVideo").files[0]);
    }

    services.push({
      title: el.querySelector(".sTitle").value || "Service",
      text: el.querySelector(".sText").value || "",
      link: el.querySelector(".sLink").value || "login.html",
      video
    });
  }

  await update(ref(db,"homepage/services"),{
    items: services,
    enabled: true
  });

  alert("Services saved safely ✅");
};


////////////////////////////////////////////////
//// SHOP HERO
////////////////////////////////////////////////

window.saveShopHero = async()=>{

let img="";

if(shopFile.files[0]){
img = await upload(shopFile.files[0]);
}else{
const snap = await get(ref(db,"homepage/shopHero"));
img = snap.val()?.image || "";
}

await update(ref(db,"homepage/shopHero"),{

title: shopTitle.value || "Shop Our Signature Styles",
button: shopButton.value || "Shop Now",
link: shopLink.value || "shop.html",
image: img,
enabled:true

});

alert("Shop hero saved safely");

};
///////////////////////////////////////////
//// AUTO LOAD (VERY IMPORTANT)
////////////////////////////////////////////////

///////////////////////////////////////////
//// AUTO LOAD (POPULATES ADMIN)
////////////////////////////////////////////////

async function load(){

  // CURATED
  const curatedSnap = await get(ref(db,"homepage/curated"));
  if(curatedSnap.exists() && curatedSnap.val().items){
    curatedWrap.innerHTML = "";
    curatedSnap.val().items.forEach(item=>{
      renderCuratedItem(item);
    });
  }

  // SERVICES
  const servicesSnap = await get(ref(db,"homepage/services"));
  if(servicesSnap.exists() && servicesSnap.val().items){
    servicesWrap.innerHTML = "";
    servicesSnap.val().items.forEach(item=>{
      renderServiceItem(item);
    });
  }

}

load();


</script>

</body>
</html>



